---
title: "StormDataAnalysis"
author: "Sebastian Cruz"
date: "April 22, 2015"
output: html_document
---

##Synopsis
This is my summary text.

##Data Processing
*Load Required Libraries*
```{r, echo=TRUE, message=FALSE}
library(ggplot2)
library(car) #recode() 
```

*Download and Import*
```{r, echo=TRUE, message=FALSE}
# Set Working directory
# Edit as necessary
setwd("~/GitHub/RepData_PeerAssessment2")

# Import Data
data.raw = read.csv(bzfile("repdata-data-StormData.csv.bz2")) #Can read .bz2 files directly with bzfile()
head(data.raw)
```

*Subset Data*
```{r, echo=TRUE, message=FALSE}
# Isolate Required Columns
data.analysis = data.raw[ ,c('EVTYPE', 'FATALITIES', 'INJURIES', 'PROPDMG', 'CROPDMG', 'PROPDMGEXP', 'CROPDMGEXP')]
head(data.analysis)
```

*Standardize Values and Magnitude*
Property Damage (PROPDMG) and Crop Damage (CROPDMG) are the estimated financial damage caused.  The value magnitudes are determined by the characters in the fields PROPDMGEXP and CROPDMGEXP according to the [data documentation] (https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf) provided, see Section 2.7 Damage. I am assuming a mapping value of 1 for the non-alphanumeric values and assuming that numerical values are the number of significant digits used in scientific notation.
Value	|	Mapping
-----	-	-------
  | 1
-	|	1
?	|	1
+	|	1
B	|	Billions
h	|	Hundreds
H	|	Hundreds
K	|	Thousands
M	|	Millions
m	|	Millions
0-9 |	Sig Digits

```{r, echo=TRUE, message=FALSE}
#Recode PROPDMGEXP values
data.analysis$PROPDMGEXP = as.numeric(
  recode(data.analysis$PROPDMGEXP, "
    c('-','?','+','') = 1;
    c('h','H') = 1e+02;
    c('k','K') = 1e+03;
    c('m','M') = 1e+06;
    c('b','B') = 1e+09;
    '0' = 1; 
    '1' = 10;
    '2' = 1e+02; 
    '3' = 1e+03; 
    '4' = 1e+04; 
    '5' = 1e+05;
    '6' = 1e+06; 
    '7' = 1e+07; 
    '8' = 1e+08;
    ", as.factor.result = FALSE
  )
)

#Update PROPDMG values with new mumeric PROPDMGEXP values
data.analysis$PROPDMG = data.analysis$PROPDMG * data.analysis$PROPDMGEXP

#Recode CROPDMGEXP values
data.analysis$CROPDMGEXP = as.numeric(
  recode(data.analysis$CROPDMGEXP, "
    c('-','?','+','') = 1;
    c('h','H') = 1e+02;
    c('k','K') = 1e+03;
    c('m','M') = 1e+06;
    c('b','B') = 1e+09;
    '0' = 1; 
    '1' = 10;
    '2' = 1e+02; 
    '3' = 1e+03; 
    '4' = 1e+04; 
    '5' = 1e+05;
    '6' = 1e+06; 
    '7' = 1e+07; 
    '8' = 1e+08;
    ", as.factor.result = FALSE
  )
)

#Update CROPDMG values with new mumeric CROPDMGEXP values
data.analysis$CROPDMG = data.analysis$CROPDMG * data.analysis$CROPDMGEXP
head(data.analysis)
```

*Add Totals for Damage and Health*
```{r, echo=TRUE, message=FALSE}
#Add PROPDMG + CROPDMG as TOTALDMG
data.analysis$TOTALDMG = data.analysis$PROPDMG + data.analysis$CROPDMG

#Add FATALITIES + INJURIES as TOTALDEATHINJ
data.analysis$TOTALDEATHINJ = data.analysis$FATALITIES + data.analysis$INJURIES
head(data.analysis)
```

*Summarize data.analysis as Health and Damage*
```{r, echo=TRUE, message=FALSE}
#Create .health dataset, Remove EXP columns for clean summerization
data.analysis.health = data.analysis[ ,c('EVTYPE','FATALITIES','INJURIES','TOTALDEATHINJ')]

#Create .damage dataset, Remove EXP columns for clean summerization
data.analysis.damage = data.analysis[ ,c('EVTYPE','','','')

colnames(data.analysis)

```



##Results 
1. Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?

2. Across the United States, which types of events have the greatest economic consequences?